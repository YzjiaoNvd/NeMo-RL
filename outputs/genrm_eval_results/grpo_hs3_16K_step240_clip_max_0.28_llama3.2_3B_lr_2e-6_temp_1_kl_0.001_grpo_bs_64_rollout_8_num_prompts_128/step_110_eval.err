2025-06-13 10:37:41,715	WARNING utils.py:594 -- Detecting docker specified CPUs. In previous versions of Ray, CPU detection in containers was incorrect. Please ensure that Ray has enough CPUs allocated. As a temporary workaround to revert to the prior behavior, set `RAY_USE_MULTIPROCESSING_CPU_COUNT=1` as an env var before starting Ray. Set the env var: `RAY_DISABLE_DOCKER_CPU_WARNING=1` to mute this warning.
2025-06-13 10:37:42,923	INFO worker.py:1832 -- Started a local Ray instance. View the dashboard at [1m[32mhttp://127.0.0.1:8265 [39m[22m
INFO:nemo_rl.distributed.virtual_cluster:Started local cluster with tag 'nrl_tag_0': {'node:__internal_head__': 1.0, 'nrl_tag_0': 1.0, 'CPU': 16.0, 'object_store_memory': 200000000000.0, 'memory': 1951718468608.0, 'node:10.65.28.135': 1.0, 'GPU': 1.0, 'accelerator_type:H100': 1.0}
Map:   0%|          | 0/350 [00:00<?, ? examples/s]Map: 100%|██████████| 350/350 [00:00<00:00, 5644.03 examples/s]
INFO:nemo_rl.utils.venvs:NEMO_RL_VENV_DIR is set to /lustre/fsw/portfolios/llmservice/users/yizhuj/NeMo-RL/venvs.
Using CPython 3.12.9 interpreter at: /home/ray/anaconda3/bin/python3
Creating virtual environment at: venvs/nemo_rl.models.generation.vllm.VllmGenerationWorker
warning: `VIRTUAL_ENV=.venv` does not match the project environment path `venvs/nemo_rl.models.generation.vllm.VllmGenerationWorker` and will be ignored; use `--active` to target the active environment instead
Resolved 313 packages in 12ms
Uninstalled 73 packages in 5.12s
 - airportsdata==20250523
 - anyio==4.9.0
 - astor==0.8.1
 - blake3==1.0.5
 - cloudpickle==3.1.1
 - compressed-tensors==0.9.3
 - cupy-cuda12x==13.4.1
 - deprecated==1.2.18
 - depyf==0.18.0
 - diskcache==5.6.3
 - distro==1.9.0
 - dnspython==2.7.0
 - email-validator==2.2.0
 - fastapi==0.115.12
 - fastapi-cli==0.0.7
 - fastrlock==0.8.3
 - gguf==0.16.3
 - h11==0.16.0
 - httpcore==1.0.9
 - httptools==0.6.4
 - httpx==0.28.1
 - importlib-metadata==8.0.0
 - interegular==0.3.3
 - jiter==0.10.0
 - lark==1.2.2
 - llguidance==0.7.24
 - llvmlite==0.44.0
 - lm-format-enforcer==0.10.11
 - mistral-common==1.5.6
 - msgspec==0.19.0
 - nest-asyncio==1.6.0
 - ninja==1.11.1.4
 - numba==0.61.2
 - openai==1.82.0
 - opencv-python-headless==4.11.0.86
 - opentelemetry-api==1.26.0
 - opentelemetry-exporter-otlp==1.26.0
 - opentelemetry-exporter-otlp-proto-common==1.26.0
 - opentelemetry-exporter-otlp-proto-grpc==1.26.0
 - opentelemetry-exporter-otlp-proto-http==1.26.0
 - opentelemetry-proto==1.26.0
 - opentelemetry-sdk==1.26.0
 - opentelemetry-semantic-conventions==0.47b0
 - opentelemetry-semantic-conventions-ai==0.4.9
 - outlines==0.1.11
 - outlines-core==0.1.26
 - partial-json-parser==0.2.1.1.post5
 - pillow==11.2.1
 - prometheus-fastapi-instrumentator==7.1.0
 - py-cpuinfo==9.0.0
 - pycountry==24.6.1
 - python-dotenv==1.1.0
 - python-json-logger==3.3.0
 - python-multipart==0.0.20
 - pyzmq==26.4.0
 - rich-toolkit==0.14.6
 - scipy==1.15.3
 - sentencepiece==0.2.0
 - shellingham==1.5.4
 - sniffio==1.3.1
 - starlette==0.46.2
 - tiktoken==0.9.0
 - torchaudio==2.6.0
 - torchvision==0.21.0
 - typer==0.16.0
 - uvicorn==0.34.2
 - uvloop==0.21.0
 - vllm==0.8.5
 - watchfiles==1.0.5
 - websockets==15.0.1
 - xformers==0.0.29.post2
 - xgrammar==0.1.18
 - zipp==3.22.0
warning: `VIRTUAL_ENV=.venv` does not match the project environment path `venvs/nemo_rl.models.generation.vllm.VllmGenerationWorker` and will be ignored; use `--active` to target the active environment instead
Installed 73 packages in 2.95s
[36m(VllmGenerationWorker pid=3427102)[0m Loading pt checkpoint shards:   0% Completed | 0/1 [00:00<?, ?it/s]
[36m(VllmGenerationWorker pid=3427102)[0m Loading pt checkpoint shards: 100% Completed | 1/1 [00:09<00:00,  9.25s/it]
[36m(VllmGenerationWorker pid=3427102)[0m Loading pt checkpoint shards: 100% Completed | 1/1 [00:09<00:00,  9.25s/it]
[36m(VllmGenerationWorker pid=3427102)[0m 
  0%|          | 0/2 [00:00<?, ?it/s][36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   0%|          | 0/256 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   0%|          | 1/256 [00:02<10:34,  2.49s/it, est. speed input: 870.76 toks/s, output: 0.40 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   1%|          | 2/256 [00:09<21:48,  5.15s/it, est. speed input: 431.48 toks/s, output: 23.35 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   2%|▏         | 4/256 [00:09<08:16,  1.97s/it, est. speed input: 854.35 toks/s, output: 68.26 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   2%|▏         | 5/256 [00:09<05:51,  1.40s/it, est. speed input: 1009.66 toks/s, output: 90.79 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   3%|▎         | 7/256 [00:09<03:17,  1.26it/s, est. speed input: 1568.69 toks/s, output: 136.37 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   4%|▍         | 11/256 [00:10<01:28,  2.77it/s, est. speed input: 2283.60 toks/s, output: 229.30 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   5%|▌         | 13/256 [00:10<01:11,  3.38it/s, est. speed input: 2588.52 toks/s, output: 271.07 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   7%|▋         | 17/256 [00:10<00:42,  5.65it/s, est. speed input: 3549.27 toks/s, output: 363.70 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   8%|▊         | 20/256 [00:10<00:31,  7.52it/s, est. speed input: 4332.63 toks/s, output: 430.75 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   9%|▉         | 24/256 [00:10<00:22, 10.38it/s, est. speed input: 5202.40 toks/s, output: 519.57 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  11%|█▏        | 29/256 [00:10<00:15, 15.09it/s, est. speed input: 6028.70 toks/s, output: 631.97 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  13%|█▎        | 33/256 [00:11<00:12, 17.57it/s, est. speed input: 6800.31 toks/s, output: 716.87 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  14%|█▍        | 36/256 [00:11<00:11, 19.55it/s, est. speed input: 7313.75 toks/s, output: 780.93 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  16%|█▌        | 40/256 [00:11<00:10, 20.63it/s, est. speed input: 7945.46 toks/s, output: 863.76 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  18%|█▊        | 45/256 [00:11<00:08, 24.45it/s, est. speed input: 8792.62 toks/s, output: 967.36 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  20%|██        | 52/256 [00:11<00:06, 31.46it/s, est. speed input: 10281.79 toks/s, output: 1115.44 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  24%|██▍       | 61/256 [00:11<00:04, 43.01it/s, est. speed input: 11892.33 toks/s, output: 1314.95 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  32%|███▏      | 81/256 [00:11<00:02, 78.06it/s, est. speed input: 15390.58 toks/s, output: 1774.01 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  36%|███▌      | 91/256 [00:11<00:02, 81.29it/s, est. speed input: 16903.38 toks/s, output: 1994.78 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  41%|████▏     | 106/256 [00:12<00:01, 95.20it/s, est. speed input: 19526.18 toks/s, output: 2335.29 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  46%|████▌     | 118/256 [00:12<00:01, 99.14it/s, est. speed input: 21330.65 toks/s, output: 2606.71 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  51%|█████     | 131/256 [00:12<00:01, 106.62it/s, est. speed input: 23865.36 toks/s, output: 2896.19 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  56%|█████▌    | 143/256 [00:12<00:01, 107.05it/s, est. speed input: 25835.76 toks/s, output: 3167.10 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  63%|██████▎   | 161/256 [00:12<00:00, 126.52it/s, est. speed input: 28924.23 toks/s, output: 3585.44 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  68%|██████▊   | 175/256 [00:12<00:00, 112.14it/s, est. speed input: 31026.36 toks/s, output: 3892.19 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  73%|███████▎  | 187/256 [00:12<00:00, 84.31it/s, est. speed input: 32573.80 toks/s, output: 4130.81 toks/s] 
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  77%|███████▋  | 197/256 [00:13<00:00, 78.06it/s, est. speed input: 33820.30 toks/s, output: 4337.12 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  80%|████████  | 206/256 [00:13<00:00, 59.30it/s, est. speed input: 34490.05 toks/s, output: 4494.52 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  84%|████████▎ | 214/256 [00:13<00:01, 37.55it/s, est. speed input: 34524.65 toks/s, output: 4526.68 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  86%|████████▌ | 220/256 [00:14<00:01, 32.33it/s, est. speed input: 34855.42 toks/s, output: 4548.72 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  88%|████████▊ | 225/256 [00:14<00:01, 30.50it/s, est. speed input: 35291.55 toks/s, output: 4605.83 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  89%|████████▉ | 229/256 [00:14<00:00, 28.32it/s, est. speed input: 35468.76 toks/s, output: 4615.74 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  93%|█████████▎| 237/256 [00:14<00:00, 35.38it/s, est. speed input: 36403.98 toks/s, output: 4738.82 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  95%|█████████▍| 242/256 [00:14<00:00, 33.09it/s, est. speed input: 36824.06 toks/s, output: 4776.83 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  96%|█████████▌| 246/256 [00:20<00:03,  3.02it/s, est. speed input: 26910.53 toks/s, output: 3631.12 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  97%|█████████▋| 249/256 [00:23<00:03,  2.21it/s, est. speed input: 23819.61 toks/s, output: 3399.79 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  98%|█████████▊| 251/256 [00:24<00:02,  2.36it/s, est. speed input: 23454.36 toks/s, output: 3495.23 toks/s]
 50%|█████     | 1/2 [00:25<00:25, 25.73s/it][36m(VllmGenerationWorker pid=3427102)[0m Processed prompts: 100%|██████████| 256/256 [00:24<00:00, 10.56it/s, est. speed input: 23735.82 toks/s, output: 3904.40 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   0%|          | 0/94 [00:00<?, ?it/s, est. speed input: 0.00 toks/s, output: 0.00 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   1%|          | 1/94 [00:03<06:09,  3.97s/it, est. speed input: 331.67 toks/s, output: 53.14 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   2%|▏         | 2/94 [00:04<02:38,  1.72s/it, est. speed input: 835.66 toks/s, output: 106.37 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:   4%|▍         | 4/94 [00:04<01:04,  1.39it/s, est. speed input: 1999.01 toks/s, output: 208.60 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  11%|█         | 10/94 [00:04<00:17,  4.75it/s, est. speed input: 4635.07 toks/s, output: 538.85 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  18%|█▊        | 17/94 [00:04<00:07,  9.70it/s, est. speed input: 8157.37 toks/s, output: 928.62 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  29%|██▊       | 27/94 [00:04<00:03, 18.40it/s, est. speed input: 12560.36 toks/s, output: 1487.23 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  39%|███▉      | 37/94 [00:04<00:02, 27.75it/s, est. speed input: 16747.89 toks/s, output: 2037.94 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  56%|█████▋    | 53/94 [00:04<00:00, 46.53it/s, est. speed input: 22810.21 toks/s, output: 2948.66 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  68%|██████▊   | 64/94 [00:05<00:00, 57.09it/s, est. speed input: 26206.73 toks/s, output: 3554.36 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  79%|███████▊  | 74/94 [00:05<00:00, 65.01it/s, est. speed input: 29269.30 toks/s, output: 4106.52 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  89%|████████▉ | 84/94 [00:05<00:00, 64.97it/s, est. speed input: 31509.87 toks/s, output: 4617.68 toks/s]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts:  99%|█████████▉| 93/94 [00:06<00:00, 29.12it/s, est. speed input: 30091.81 toks/s, output: 4644.63 toks/s]
100%|██████████| 2/2 [00:39<00:00, 18.97s/it]100%|██████████| 2/2 [00:39<00:00, 19.98s/it]
[36m(VllmGenerationWorker pid=3427102)[0m Processed prompts: 100%|██████████| 94/94 [00:13<00:00,  6.84it/s, est. speed input: 13370.37 toks/s, output: 2190.56 toks/s]
